<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>(Incident Response tactics with Compromise Indicators)</title>
<meta name="author" content="(Vladimir Kropotov, Vitaly Chetvertakov, Fyodor Yarochkin)"/>
<link rel="stylesheet" href="./reveal.js/css/reveal.min.css"/>
<link rel="stylesheet" href="./reveal.js/css/theme/moon.css" id="theme"/>

<link rel="stylesheet" href="./reveal.js/css/print/pdf.css" type="text/css" media="print"/>
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>
<body>
ox-reveal-jekyll-preamble
<div class="reveal">
<div class="slides">
<section>
<h1>Incident Response tactics with Compromise Indicators</h1>
<h2>Vladimir Kropotov, Vitaly Chetvertakov, Fyodor Yarochkin</h2>
<h2><a href="mailto:"></a></h2>
<h2></h2></section>
<section>
<h2>Table of Contents</h2><ul>
<li>
<a href="#sec-1">Basics</a>
<ul>
<li>
<a href="#sec-1-1">Introduction</a>
</li>
<li>
<a href="#sec-1-2">IOC workflow</a>
</li>
</ul>
<li>
<a href="#sec-2">Standards</a>
<ul>
<li>
<a href="#sec-2-1">Standards: OpenIOC</a>
</li>
<li>
<a href="#sec-2-2">Standards: Mitre</a>
</li>
</ul>
<li>
<a href="#sec-3">Tools</a>
<ul>
<li>
<a href="#sec-3-1">Open-source tools</a>
</li>
</ul>
<li>
<a href="#sec-4">Sharing IOCs</a>
<ul>
<li>
<a href="#sec-4-1">Online Sharing of IOCs</a>
</li>
<li>
<a href="#sec-4-2">Policies on Sharing</a>
</li>
</ul>
<li>
<a href="#sec-5">IOCs composites</a>
<ul>
<li>
<a href="#sec-5-1">Where to look for IOCs:</a>
</li>
<li>
<a href="#sec-5-2">Challenges</a>
</li>
<li>
<a href="#sec-5-3">Challenges</a>
</li>
</ul>
<li>
<a href="#sec-6">Case Study</a>
<ul>
<li>
<a href="#sec-6-1">An Example</a>
</li>
<li>
<a href="#sec-6-2">Indicators</a>
</li>
<li>
<a href="#sec-6-3">Good or Bad?</a>
</li>
<li>
<a href="#sec-6-4">It really depends on context</a>
</li>
</ul>
<li>
<a href="#sec-7">More on Tools</a>
<ul>
<li>
<a href="#sec-7-1">Tools for Dynamic Detection of IOC</a>
</li>
<li>
<a href="#sec-7-2">Tools for Dynamic Detection</a>
</li>
<li>
<a href="#sec-7-3">Sources of IOCs</a>
</li>
<li>
<a href="#sec-7-4">where to mine IOC</a>
</li>
<li>
<a href="#sec-7-5">Mining IOCs from your own data</a>
</li>
<li>
<a href="#sec-7-6">Example</a>
</li>
<li>
<a href="#sec-7-7">Use YARA, or tune your own tools</a>
</li>
<li>
<a href="#sec-7-8">Use snort to catch suspicious traffic:</a>
</li>
<li>
<a href="#sec-7-9">IOC management portal</a>
</li>
<li>
<a href="#sec-7-10">and show nice graphs ;)</a>
</li>
</ul>
<li>
<a href="#sec-8">Questions</a>
<ul>
<li>
<a href="#sec-8-1">Q and A</a>
</li>
</ul>
</section>

<section id="sec-1" >

<h2><span class="section-number-2">1</span> Basics</h2>
</section>
<section>
<section id="sec-1-1" >

<h3><span class="section-number-3">1.1</span> Introduction</h3>
<p>
<b>Indicators of Compromise</b>
</p>

<p>
Indicator of compromise (IOC) in computer forensics is an artifact
observed on network or in operating system that with high confidence
indicates a computer intrusion.
</p>

<p>
<a href="http://en.wikipedia.org/wiki/Indicator_of_compromise">http://en.wikipedia.org/wiki/Indicator_of_compromise</a>
</p>
</section>


</section>
<section>
<section id="sec-1-2" >

<h3><span class="section-number-3">1.2</span> IOC workflow</h3>
<p>
A typical flow with Indicators of Compromise allows
to integrate dynamic threat intelligence into detection 
process:
</p>
<img src="images/ioc.png" alt="ioc.png" />

<p>
source: Sophisticated indicators for the modern threat landscape, 2012
paper
</p>
</section>
</section>
<section id="sec-2" >

<h2><span class="section-number-2">2</span> Standards</h2>
</section>
<section>
<section id="sec-2-1" >

<h3><span class="section-number-3">2.1</span> Standards: OpenIOC</h3>
<p>
OpenIOC - Mandiant-backed effort for unform representation of IOC
(now FireEye)
<a href="http://www.openioc.org/">http://www.openioc.org/</a>
<img src="images/zeus-ioc.png" alt="zeus-ioc.png" />
</p>
</section>
</section>
<section>
<section id="sec-2-2" >

<h3><span class="section-number-3">2.2</span> Standards: Mitre</h3>
<p>
Mitre CybOX:
<a href="http://cybox.mitre.org/">http://cybox.mitre.org/</a>
<a href="https://github.com/CybOXProject/Tools">https://github.com/CybOXProject/Tools</a>
<a href="https://github.com/CybOXProject/openioc-to-cybox">https://github.com/CybOXProject/openioc-to-cybox</a>
Mitre CAPEC:
<a href="http://capec.mitre.org/">http://capec.mitre.org/</a>
Mitre STIX:
<a href="http://stix.mitre.org/">http://stix.mitre.org/</a>
Mitre TAXII
<a href="http://taxii.mitre.org/">http://taxii.mitre.org/</a>
</p>
</section>
</section>
<section id="sec-3" >

<h2><span class="section-number-2">3</span> Tools</h2>
</section>
<section>
<section id="sec-3-1" >

<h3><span class="section-number-3">3.1</span> Open-source tools</h3>
<p>
OpenIOC manipulation
<a href="https://github.com/STIXProject/openioc-to-stix">https://github.com/STIXProject/openioc-to-stix</a>
<a href="https://github.com/tklane/openiocscripts">https://github.com/tklane/openiocscripts</a> 
</p>

<p>
Mantis Threat Intelligence Framework
 <a href="https://github.com/siemens/django-mantis.git">https://github.com/siemens/django-mantis.git</a>
Mantis supports STIX/CybOX/IODEF/OpenIOC etc via
importers: <a href="https://github.com/siemens/django-mantis-openioc-importer">https://github.com/siemens/django-mantis-openioc-importer</a>
</p>


<p>
Search splunk data for IOC indicators:
<a href="https://github.com/technoskald/splunk-search">https://github.com/technoskald/splunk-search</a>
</p>

<p>
Our framework:
<a href="http://github.com/fygrave/iocmap/">http://github.com/fygrave/iocmap/</a>
</p>
</section>
</section>
<section id="sec-4" >

<h2><span class="section-number-2">4</span> Sharing IOCs</h2>
</section>
<section>
<section id="sec-4-1" >

<h3><span class="section-number-3">4.1</span> Online Sharing of IOCs</h3>
<p>
<a href="http://iocbucket.com/">http://iocbucket.com/</a>
</p>

<img src="images/iocbucket.png" alt="iocbucket.png" />
</section>
</section>
<section>
<section id="sec-4-2" >

<h3><span class="section-number-3">4.2</span> Policies on Sharing</h3>
<p>
Policies on sharing IOCs:
</p>

<ul class="org-ul">
<li>what to be shared/can be shared
</li>
<li>who to share with
</li>
<li>when to share
</li>
</ul>
</section>
</section>
<section id="sec-5" >

<h2><span class="section-number-2">5</span> IOCs composites</h2>
</section>
<section>
<section id="sec-5-1" >

<h3><span class="section-number-3">5.1</span> Where to look for IOCs:</h3>
<ul class="org-ul">
<li>Outbound Network Traffic
</li>
<li>User Activities/Failed Logins
</li>
<li>User profile folders
</li>
<li>Administrative Access
</li>
<li>Access from unsual IP addresses
</li>
<li>Database IO: excessive READs
</li>
<li>Size of responses of web pages 
</li>
<li>Unusual access to particular files within Web Application (backdoor)
</li>
<li>Unusual port/protocol connections
</li>
<li>DNS and HTTP traffic requests
</li>
<li>Suspicious Scripts, Executables and Data Files
</li>
</ul>
</section>
</section>
<section>
<section id="sec-5-2" >

<h3><span class="section-number-3">5.2</span> Challenges</h3>
<p>
Why we need IOCs? because it makes it easier to
systematically describe knowledge about breaches.
</p>

<ul class="org-ul">
<li>Identifying intrusions is hard
</li>
<li>Unfair game:
<ul class="org-ul">
<li>defender should protect all the assets
</li>
<li>attacker only needs to 'poop' one system.
</li>
</ul>
</li>
<li>Identifying targeted, organized intrusions is even harder
</li>
<li>Minor anomalous events are important when put together
</li>
<li>Seeing global picture is a mast
</li>
<li>Details matter
</li>
<li>Attribution is hard
</li>
</ul>
</section>
</section>
<section>
<section id="sec-5-3" >

<h3><span class="section-number-3">5.3</span> Challenges</h3>
<p>
<b>All networks are compromised</b>
</p>


<p>
The difference between a good security team and a bad security team is
that with a bad security team you will never know that you've been
compromised.
</p>
</section>
</section>
<section id="sec-6" >

<h2><span class="section-number-2">6</span> Case Study</h2>
</section>
<section>
<section id="sec-6-1" >

<h3><span class="section-number-3">6.1</span> An Example</h3>
<p>
A Network compromise case study:
</p>
<ul class="org-ul">
<li>Attackers broke via a web vuln.
</li>
<li>Attackers gained local admin access
</li>
<li>Attackers created a local user
</li>
<li>Attackers started probing other machines for default user ids
</li>
<li>Attackers launched tunneling tools â€“ connecting back to C2
</li>
<li>Attackers installed RATs to maintain access
</li>
</ul>
</section>
</section>
<section>
<section id="sec-6-2" >

<h3><span class="section-number-3">6.2</span> Indicators</h3>
<p>
So what are the compromise indicators here?
</p>

<ul class="org-ul">
<li>Where did attackers come from? (IP)
</li>
<li>What vulnerability was exploited? (pattern)
</li>
<li>What web backdoor was used? (pattern, hash)
</li>
<li>What tools were uploaded? (hashes)
</li>
<li>What users were created locally? (username)
</li>
<li>What usernames were probed on other machines
</li>
</ul>
</section>

</section>
<section>
<section id="sec-6-3" >

<h3><span class="section-number-3">6.3</span> Good or Bad?</h3>
<p>
\tiny
</p>
<div class="org-src-container">

<pre class="src src-sh">File Name                       : RasTls.exe
File Size                       : 105 kB
File Modification Date/Time     : 2009:02:09 19:42:05+08:00
File Type                       : Win32 EXE
MIME Type                       : application/octet-stream
Machine Type                    : Intel 386 or later, and compatibles
Time Stamp                      : 2009:02:02 13:38:37+08:00
PE Type                         : PE32
Linker Version                  : 8.0
Code Size                       : 49152
Initialized Data Size           : 57344
Uninitialized Data Size         : 0
Entry Point                     : 0x3d76
OS Version                      : 4.0
Image Version                   : 0.0
Subsystem Version               : 4.0
Subsystem                       : Windows GUI
File Version Number             : 11.0.4010.7
Product Version Number          : 11.0.4010.7
File OS                         : Windows NT 32-bit
Object File Type                : Executable application
Language Code                   : English (U.S.)
Character Set                   : Windows, Latin1
Company Name                    : Symantec Corporation
File Description                : Symantec 802.1x Supplicant
File Version                    : 11.0.4010.7
Internal Name                   : dot1xtray
</pre>
</div>
<p>
\normalsize
</p>
</section>
</section>
<section>
<section id="sec-6-4" >

<h3><span class="section-number-3">6.4</span> It really depends on context</h3>
<div class="org-src-container">

<pre class="src src-sh">RasTls.DLL 
RasTls.DLL.msc
RasTls.exe
</pre>
</div>

<p>
<a href="http://msdn.microsoft.com/en-us/library/ms682586(v=VS.85).aspx">http://msdn.microsoft.com/en-us/library/ms682586(v=VS.85).aspx</a>
</p>

<p>
<b>Dynamic-Link Library Search Order</b>
</p>

<img src="images/pantsdown.jpg" alt="pantsdown.jpg" />
</section>


</section>
<section id="sec-7" >

<h2><span class="section-number-2">7</span> More on Tools</h2>
</section>
<section>
<section id="sec-7-1" >

<h3><span class="section-number-3">7.1</span> Tools for Dynamic Detection of IOC</h3>
<ul class="org-ul">
<li>Snort
</li>
<li>Yara + yara-enabled tools
</li>
<li>Moloch
</li>
<li>Splunk/Log search
</li>
</ul>
</section>
</section>
<section>
<section id="sec-7-2" >

<h3><span class="section-number-3">7.2</span> Tools for Dynamic Detection</h3>
<ul class="org-ul">
<li>Moloch
<ul class="org-ul">
<li>Moloch supports Yara (IOCs can be directly applied)
</li>
<li>Moloch has tagger plugin:
</li>
</ul>
</li>
</ul>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">tagger.so</span>
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">provides ability to import text files with IP and/or hostnames </span>
<span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">into a sensor that would cause autotagging of all matching sessions</span>
<span style="color: #DFAF8F;">plugins</span>=tagger.so
<span style="color: #DFAF8F;">taggerIpFiles</span>=blacklist,tag,tag,tag...
<span style="color: #DFAF8F;">taggerDomainFiles</span>=domainbasedblacklists, tag, tag, tag
</pre>
</div>
</section>
</section>
<section>
<section id="sec-7-3" >

<h3><span class="section-number-3">7.3</span> Sources of IOCs</h3>
<p>
ioc collection
<a href="http://iocbucket.com">http://iocbucket.com</a>
</p>

<p>
Public blacklists/trackers could also be used as source:
</p>

<p>
<a href="https://zeustracker.abuse.ch/blocklist.php?download=ipblocklist">https://zeustracker.abuse.ch/blocklist.php?download=ipblocklist</a>
</p>

<p>
<a href="https://zeustracker.abuse.ch/blocklist.php?download=domainblocklist">https://zeustracker.abuse.ch/blocklist.php?download=domainblocklist</a>
</p>
</section>
</section>
<section>
<section id="sec-7-4" >

<h3><span class="section-number-3">7.4</span> where to mine IOC</h3>
<ul class="org-ul">
<li>passive HTTP (keep your data recorded)
</li>
<li>passive DNS
</li>
</ul>

<p>
These platforms provide
ability to mine traffic or patterns from the past
based on IOC similarity
</p>

<p>
<b>show me all the packets similar to this IOC</b>
</p>

<p>
We implemented a whois service for IOC look-ups
</p>
<div class="org-src-container">

<pre class="src src-sh">whois -h ioc.host.com   attribute:value+attribute:value
</pre>
</div>
</section>

</section>
<section>
<section id="sec-7-5" >

<h3><span class="section-number-3">7.5</span> Mining IOCs from your own data</h3>
<ul class="org-ul">
<li>find and investigate incident
</li>
<li>Or even read paper
</li>
<li>determine indicators and test it in YOUR Environment
</li>
<li>use new indicators in the future

<p>
<b>see IOC cycle we mentioned earlier</b>
</p>
</li>
</ul>
</section>
</section>
<section>
<section id="sec-7-6" >

<h3><span class="section-number-3">7.6</span> Example</h3>
<p>
If event chain leads to compromise
</p>
<div class="org-src-container">

<pre class="src src-sh">http:// liapolasens[.]info/indexm.html

http:// liapolasens[.]info/counter.php?<span style="color: #DFAF8F;">t</span>=f&amp;<span style="color: #DFAF8F;">v</span>=win%2011,7,700,169&amp;<span style="color: #DFAF8F;">a</span>=true

http:// liapolasens[.]info/354RIcx

http:// liapolasens[.]info/054RIcx
</pre>
</div>
<p>
What to do?
</p>
</section>
</section>
<section>
<section id="sec-7-7" >

<h3><span class="section-number-3">7.7</span> Use YARA, or tune your own tools</h3>
<div class="org-src-container">

<pre class="src src-sh">rule susp_params_in_url_kind_of_fileless_bot_drive_by
{
        meta:
        date = <span style="color: #CC9393;">"oct 2013"</span>
        description = <span style="color: #CC9393;">"Landing hxxp://jdatastorelame.info/indexm.html  04.10.2013 13:14  108.62.112.84  "</span>  
        description1 =  <span style="color: #CC9393;">" Java Sploit hxxp://jdatastorelame.info/054RIwj     "</span>


    strings:
        $<span style="color: #DFAF8F;">string0</span> = <span style="color: #CC9393;">"http"</span>
        $<span style="color: #DFAF8F;">string1</span> = <span style="color: #CC9393;">"indexm.html"</span>
        $<span style="color: #DFAF8F;">string2</span> = <span style="color: #CC9393;">"054RI"</span>



    condition:
        all of them
}
</pre>
</div>
</section>
</section>
<section>
<section id="sec-7-8" >

<h3><span class="section-number-3">7.8</span> Use snort to catch suspicious traffic:</h3>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #5F7F5F;"># </span><span style="color: #7F9F7F;">many plugX deployments connect to google DNS when not in use</span>
alert tcp !$<span style="color: #DFAF8F;">DNS_SERVERS</span> any -&gt; 8.8.8.8 53 (msg:<span style="color: #CC9393;">"APT possible PlugX Google DNS TCP</span>
<span style="color: #CC9393;">port 53 connection attempt"</span>; classtype:misc-activity; sid:500000112;
rev:1;)
</pre>
</div>
</section>
</section>
<section>
<section id="sec-7-9" >

<h3><span class="section-number-3">7.9</span> IOC management portal</h3>
<p>
IOC management can be automated
<img src="images/ioc01.png" alt="ioc01.png" />
</p>
</section>

</section>
<section>
<section id="sec-7-10" >

<h3><span class="section-number-3">7.10</span> and show nice graphs ;)</h3>
<p>
every manager loves graphs :p
<img src="images/ioc02.png" alt="ioc02.png" />
</p>
</section>

</section>
<section id="sec-8" >

<h2><span class="section-number-2">8</span> Questions</h2>
</section>
<section>
<section id="sec-8-1" >

<h3><span class="section-number-3">8.1</span> Q and A</h3>
<p>
Or contact us at &#x2026;
</p>
</section>
</section>
</div>
</div>
<script src="./reveal.js/lib/js/head.min.js"></script>
<script src="./reveal.js/js/reveal.min.js"></script>
<script>

        		// Full list of configuration options available here:
        		// https://github.com/hakimel/reveal.js#configuration
        		Reveal.initialize({
        			controls: true,
        			progress: true,
        			history: false,
        			center: true,
        			rollingLinks: true,
        			keyboard: true,
        			overview: true,
        			width: 1200, // slide width
        			height: 800, // slide height
        			margin: 0.10, // slide margin
        			minScale: 0.50, // slide minimum scaling factor
        			maxScale: 2.50, // slide maximum scaling factor


        			theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
        			transition: Reveal.getQueryHash().transition || 'cube', // default/cube/page/concave/zoom/linear/fade/none
        			transitionSpeed: 'default',

        			// Optional libraries used to extend on reveal.js
        			dependencies: [
        				{ src: './reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } }
        				,{ src: './reveal.js/plugin/markdown/showdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } }
        				,{ src: './reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } }
        				,{ src: './reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
        				,{ src: './reveal.js/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } }
        				,{ src: './reveal.js/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
        				// { src: './reveal.js/plugin/search/search.js', async: true, condition: function() { return !!document.body.classList; } }
        				// { src: './reveal.js/plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } }
         				
        			]
        		});
</script>
</body>
</html>
